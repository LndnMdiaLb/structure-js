<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title></title>
	<script type="text/javascript" src='structure.js'></script>
</head>
<body>

	<div class="a"></div>
	<div class="b"></div>
	<div class="c"></div>	
	<div class="d"></div>
	<div class="e"></div>
	<div class="f"></div>

	<script type="text/javascript">

	////////// collections.js

	var a = new app.Map;
	a.add('x','x');
	a.add('x','y');
	a.add('x','z');
	a.add('x','o');
	a.remove('x','o');
	a.add('y','o');
	console.log(a)
	
	var s = new app.Set;
	s.add('x');
	s.add('x', 'y');
	s.add(['x', 'y']);

	//////////

	////////// dispatcher.js

	var b = new app.Dispatcher;
	var c = new app.Dispatcher(true);
	var d = {}

	b.augment(d);

	d.register('a',
		function(){
			console.log('d registered for a event using b')
		}) ;	

	b.register('a',
		function(){
			console.log('b registered for a event')
		}) ;

	c.register('a',
		function(){
			console.log('if only c is visible c a private dispatcher')
		}) ;	

	c.emit('a');

	//////////

	////////// statemachine.js

	var Sequence = function(){
		var sm = new app.StateMachine;
		var d = new app.Dispatcher;
		// compostion
		sm.augment(this);
		d.augment(this);
	}	

	var sm = new Sequence;

	sm.register('x', 
		function(){
			console.log('Compostion via through methods works');
		})

	sm.addState('a', function(){
		console.log('state a')
		sm.setNextState('b') ;
		sm.changeState() ;
	})

	sm.addState('b', function(){
		console.log('state b') ;
		sm.goTo('c') ;
	})	

	sm.addState('c', function(){
		console.log('state c') ;
		sm.emit('x') ;
	})		

	sm.register('img-loaded', function(){
		console.log('global img-loaded caught')
	})

	sm.goTo('a');

	//////////	


	window.onload =function(){

		app.utils.addClass(document.querySelector('.a'), 'x')
		app.utils.addClass(document.querySelector('.b'), 'x')
		app.utils.addClass(document.querySelector('.c'), 'x')
		app.utils.addClass(document.querySelector('.d'), 'x')
		app.utils.addClass(document.querySelector('.e'), 'x')
		app.utils.addClass(document.querySelector('.f'), 'x')
		app.utils.addClass(document.querySelector('.f'), 'y')

		// app.utils.addClass(document.querySelector('.f'), 'z')

		/////////////
		// timed classes
		/////////////

		app.utils
			.addClass(document.querySelector('.f'), 'z', 6000)
			.addClass(document.querySelector('.f'), 'o', 6000)
		
			.removeClass(document.querySelector('.f'), 'z', 12000)
	
			.removeClass(document.querySelector('.f'), 'o', 18000)

			// kills removeClass
			.removeClass.kill(document.querySelector('.f'), 'o')
		
			.reset(null, 25000) ;

		setTimeout(function(){
			console.log(document.querySelector('.f').addtimers)
		}, 20000)

		window.iLoader = iLoader = new app.utils.IMGLoader()
		iLoader.pause()

		// iLoader.load(
		// 	['img1.png', 'img2.png'],
		// 	function(e){
		// 		console.log(e.currentTarget.src, 'loaded')
		// 	} , 
		// 	'img-loaded' )

		// iLoader.load(
		// 	['img3.png', 'img4.png'],
		// 	function(e){
		// 		console.log(e.currentTarget.src, 'loaded')
		// 	} , 
		// 	'img-loaded' )

		// iLoader.start('img-loaded')

		// iLoader.load(
		// 	['img5.png'],
		// 	function(e){
		// 		console.log(e.currentTarget.src, 'loaded')
		// 	} , 
		// 	'img-loaded' )		

		

		//iLoader.start('img-loaded-2')

		iLoader.register('img-loaded', function(){
			console.log('private img-loaded caught')
		})

		setTimeout( function(){
			iLoader.start('img-loaded');
		}, 2000)		;
	}

	

	</script>
</body>
</html>